<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WA Sender</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--g:#25D366;--gd:#1a9e4a;--r:#ef4444;--am:#f59e0b;--bg:#060a08;--sf:#0c1310;--sf2:#111b16;--bd:#172620;--t:#e2f0e8;--td:#5a7d6a;--tl:#3d5c4c}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t);min-height:100vh}
.app{max-width:520px;margin:0 auto;padding:40px 20px}
.header{display:flex;align-items:center;gap:16px;margin-bottom:32px;animation:up .6s ease-out}
.logo{width:48px;height:48px;background:linear-gradient(135deg,var(--g),var(--gd));border-radius:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 24px rgba(37,211,102,.25)}
.logo svg{width:26px;height:26px;fill:#fff}
.header h1{font-size:20px;font-weight:700}
.header p{font-size:13px;color:var(--td);margin-top:2px}

.card{background:var(--sf);border:1px solid var(--bd);border-radius:18px;padding:26px;margin-bottom:16px;animation:up .6s ease-out}
@keyframes up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

.sec{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:2px;color:var(--tl);margin-bottom:20px}

.field{margin-bottom:16px}
label{display:block;font-size:13px;color:var(--td);margin-bottom:6px}
input,textarea,select{width:100%;background:var(--bg);border:1.5px solid var(--bd);border-radius:10px;padding:12px 14px;font-family:'Outfit',sans-serif;font-size:15px;color:var(--t);outline:none;transition:border .2s}
input:focus,textarea:focus{border-color:var(--g);box-shadow:0 0 0 3px rgba(37,211,102,.1)}
textarea{resize:vertical;min-height:100px;line-height:1.6}
select{cursor:pointer;appearance:none}
input::placeholder,textarea::placeholder{color:var(--tl)}

.row{display:flex;gap:8px}
.row select{width:100px;flex-shrink:0}
.row input{flex:1}

.chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px}
.chip{padding:5px 11px;background:var(--sf2);border:1px solid var(--bd);border-radius:7px;font-size:12px;color:var(--td);cursor:pointer;transition:all .2s}
.chip:hover{border-color:var(--g);color:var(--g)}

.btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--g),var(--gd));border:none;border-radius:10px;color:#fff;font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;box-shadow:0 4px 16px rgba(37,211,102,.25);position:relative}
.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 24px rgba(37,211,102,.35)}
.btn:disabled{opacity:.5;cursor:wait}
.btn svg{width:18px;height:18px;fill:#fff}
.btn.loading .txt{opacity:0}
.btn .spin{display:none;position:absolute;width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:sp .5s linear infinite}
.btn.loading .spin{display:block}
@keyframes sp{to{transform:rotate(360deg)}}

.resp{margin-top:12px;padding:10px 14px;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:12px;display:none}
.resp.ok{display:block;background:rgba(37,211,102,.08);border:1px solid rgba(37,211,102,.2);color:var(--g)}
.resp.err{display:block;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);color:var(--r)}

.hist{display:flex;flex-direction:column;gap:6px}
.hi{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg);border:1px solid var(--bd);border-radius:10px}
.hi-i{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
.hi-i.ok{background:rgba(37,211,102,.1);color:var(--g)}
.hi-i.fail{background:rgba(239,68,68,.1);color:var(--r)}
.hi-d{flex:1;min-width:0}
.hi-n{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:600}
.hi-m{font-size:12px;color:var(--td);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hi-t{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--tl)}

.kd{display:flex;align-items:center;justify-content:space-between;background:var(--bg);border:1px solid var(--bd);border-radius:10px;padding:8px 14px;margin-bottom:16px}
.kd span{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--td)}
.kd button{background:none;border:1px solid var(--bd);border-radius:6px;padding:3px 10px;font-size:11px;color:var(--td);cursor:pointer}
.kd button:hover{border-color:var(--g);color:var(--g)}

.toast{position:fixed;bottom:24px;left:50%;padding:12px 20px;border-radius:10px;font-size:13px;font-weight:500;z-index:99;transform:translateX(-50%) translateY(80px);opacity:0;transition:all .3s ease-out;box-shadow:0 6px 30px rgba(0,0,0,.4)}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.success{background:var(--g);color:#fff}
.toast.error{background:var(--r);color:#fff}

.hint{text-align:center;font-size:10px;color:var(--tl);margin-top:16px;opacity:.5}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="logo"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></div>
    <div><h1>WA Sender</h1><p>via TextMeBot</p></div>
  </div>

  <!-- Setup -->
  <div class="card" id="setup">
    <div class="sec">Einrichtung</div>
    <div style="font-size:14px;color:var(--td);line-height:2;margin-bottom:12px">
      1. <a href="https://textmebot.com" target="_blank" style="color:var(--g)">textmebot.com</a> â†’ API-Key holen<br>
      2. WhatsApp-Nummer verbinden (Link per E-Mail)<br>
      3. Key hier eintragen:
    </div>
    <div class="row">
      <input type="text" id="keyIn" placeholder="Dein API-Key">
      <button class="btn" style="width:auto;padding:12px 20px" onclick="saveKey()">OK</button>
    </div>
  </div>

  <!-- Sender -->
  <div class="card">
    <div class="sec">Nachricht senden</div>
    <div class="kd" id="keyBar" style="display:none">
      <span>Key: <span id="keyPrev"></span></span>
      <button onclick="changeKey()">Ã„ndern</button>
    </div>

    <div class="field">
      <label>Nummer</label>
      <div class="row">
        <select id="cc">
          <option value="+43">ðŸ‡¦ðŸ‡¹ +43</option>
          <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
          <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
          <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
          <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
          <option value="+33">ðŸ‡«ðŸ‡· +33</option>
          <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
          <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
          <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
          <option value="+48">ðŸ‡µðŸ‡± +48</option>
        </select>
        <input type="tel" id="phone" placeholder="660 1234567">
      </div>
    </div>

    <div class="chips">
      <span class="chip" data-m="Hallo! Wie geht es dir?">Hallo</span>
      <span class="chip" data-m="Vielen Dank fÃ¼r Ihre Nachricht!">Danke</span>
      <span class="chip" data-m="Erinnerung: Unser Termin ist morgen.">Erinnerung</span>
      <span class="chip" data-m="Ihre Bestellung wurde versandt!">Versand</span>
    </div>

    <div class="field">
      <label>Nachricht</label>
      <textarea id="msg" placeholder="Nachricht eingeben..."></textarea>
    </div>

    <button class="btn" id="sendBtn" onclick="send()">
      <span class="txt" style="display:flex;align-items:center;gap:8px">
        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        Senden
      </span>
      <span class="spin"></span>
    </button>
    <div class="resp" id="resp"></div>
  </div>

  <!-- History -->
  <div class="card" id="histCard" style="display:none">
    <div class="sec">Verlauf</div>
    <div class="hist" id="hist"></div>
  </div>

  <p class="hint">Key wird nur lokal gespeichert Â· Strg+Enter zum Senden</p>
</div>
<div class="toast" id="toast"></div>

<script>
let key = localStorage.getItem('k')||'';
let hist = JSON.parse(localStorage.getItem('h')||'[]');

function init(){
  if(key){
    document.getElementById('setup').style.display='none';
    document.getElementById('keyBar').style.display='flex';
    document.getElementById('keyPrev').textContent=key.slice(0,6)+'Â·Â·Â·';
    document.getElementById('phone').focus();
  } else {
    document.getElementById('setup').style.display='block';
    document.getElementById('keyBar').style.display='none';
    document.getElementById('keyIn').focus();
  }
  renderHist();
}

function saveKey(){
  const v=document.getElementById('keyIn').value.trim();
  if(!v) return toast('Key eingeben','error');
  key=v; localStorage.setItem('k',v); init(); toast('Key gespeichert!','success');
}
function changeKey(){
  document.getElementById('setup').style.display='block';
  document.getElementById('keyIn').value=key;
  document.getElementById('keyIn').focus();
}

document.querySelectorAll('.chip').forEach(c=>c.onclick=()=>{
  document.getElementById('msg').value=c.dataset.m;
  document.getElementById('msg').focus();
});

async function send(){
  if(!key) return toast('Erst Key eintragen','error');
  const pre=document.getElementById('cc').value;
  const ph=document.getElementById('phone').value.trim();
  const msg=document.getElementById('msg').value.trim();
  if(!ph) return toast('Nummer eingeben','error');
  if(!msg) return toast('Nachricht eingeben','error');

  let n=ph.replace(/[^0-9]/g,'');
  if(n.startsWith('0')) n=n.slice(1);
  const full=pre+n;

  const btn=document.getElementById('sendBtn');
  const resp=document.getElementById('resp');
  btn.classList.add('loading'); btn.disabled=true;
  resp.className='resp';

  try{
    const url='/api/send?recipient='+encodeURIComponent(full)+'&apikey='+encodeURIComponent(key)+'&text='+encodeURIComponent(msg);
    const r=await fetch(url);
    const d=await r.json();

    resp.textContent='API: '+d.msg;
    const low=d.msg.toLowerCase();

    if(low.includes('sent')||low.includes('queued')||low.includes('success')){
      resp.className='resp ok';
      toast('Gesendet!','success');
      addHist(full,msg,'ok');
      document.getElementById('msg').value='';
    } else {
      resp.className='resp err';
      toast('Fehler: '+d.msg,'error');
      addHist(full,msg,'fail');
    }
  }catch(e){
    resp.textContent='Verbindung fehlgeschlagen';
    resp.className='resp err';
    toast('Server-Fehler','error');
    addHist(full,msg,'fail');
  }finally{
    btn.classList.remove('loading'); btn.disabled=false;
  }
}

function addHist(to,msg,st){
  hist.unshift({to,msg,st,t:new Date().toISOString()});
  if(hist.length>20) hist=hist.slice(0,20);
  localStorage.setItem('h',JSON.stringify(hist));
  renderHist();
}

function renderHist(){
  const c=document.getElementById('histCard');
  const l=document.getElementById('hist');
  if(!hist.length){c.style.display='none';return}
  c.style.display='block';
  l.innerHTML=hist.map(h=>{
    const t=new Date(h.t);
    const ts=t.toLocaleTimeString('de',{hour:'2-digit',minute:'2-digit'});
    const ds=t.toLocaleDateString('de',{day:'2-digit',month:'2-digit'});
    return '<div class="hi"><div class="hi-i '+(h.st==='ok'?'ok':'fail')+'">'+(h.st==='ok'?'âœ“':'âœ—')+'</div><div class="hi-d"><div class="hi-n">'+esc(h.to)+'</div><div class="hi-m">'+esc(h.msg)+'</div></div><div class="hi-t">'+ds+' '+ts+'</div></div>';
  }).join('');
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

function toast(m,ty){
  const t=document.getElementById('toast');
  t.textContent=m;t.className='toast '+ty+' show';
  setTimeout(()=>t.classList.remove('show'),3000);
}

document.getElementById('phone').onkeydown=e=>{if(e.key==='Enter')document.getElementById('msg').focus()};
document.getElementById('msg').onkeydown=e=>{if(e.key==='Enter'&&e.ctrlKey)send()};
document.getElementById('keyIn').onkeydown=e=>{if(e.key==='Enter')saveKey()};

init();
</script>
</body>
</html>
